<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.leyizhuang.app.foundation.dao.OrderDAO">

    <select id="getGoodsInfoByOrderNumber" parameterType="java.lang.String"
            resultType="cn.com.leyizhuang.app.foundation.pojo.MaterialListDO">
        SELECT DISTINCT g.gid, g.sku, g.sku_name, g.goods_specification, g.cover_image_uri, g.goods_unit,
            og.order_qty qty
        FROM ord_goods_info og
        LEFT JOIN gds_goods g ON g.sku = og.sku
        WHERE og.ord_no = #{orderNumber}
        AND (og.is_gift IS NULL OR og.is_gift = false)
    </select>

    <select id="getOrderListByUserIDAndIdentityType"
            resultType="cn.com.leyizhuang.app.foundation.pojo.order.OrderBaseInfo">
        <if test="null != identityType and identityType.toString() == 'CUSTOMER'">
            SELECT
            obi.`status`,
            obi.ord_no,
            obi.effective_end_time,
            obi.delivery_type
            FROM
            ord_base_info AS obi
            WHERE
            obi.customer_id = #{userID}
        </if>
        <if test="null != identityType and identityType.toString() == 'DECORATE_MANAGER'">
            SELECT
            obi.`status`,
            obi.ord_no,
            obi.effective_end_time,
            obi.delivery_type
            FROM
            ord_base_info AS obi
            WHERE
            obi.manager_id = #{userID}
        </if>
        <if test="null != identityType and identityType.toString() == 'SELLER'">
            SELECT
            obi.`status`,
            obi.ord_no,
            obi.effective_end_time,
            obi.delivery_type
            FROM
            ord_base_info AS obi
            WHERE
            obi.sales_consult_id = #{userID}
        </if>
    </select>

    <select id="getFuzzyQuery" resultType="cn.com.leyizhuang.app.foundation.pojo.order.OrderBaseInfo">
        <if test="null != identityType and identityType.toString() == 'CUSTOMER'">
            SELECT
            obi.`status`,
            obi.ord_no,
            obi.effective_end_time,
            obi.delivery_type
            FROM
            ord_base_info AS obi
            INNER JOIN ord_logistics_info AS oli ON obi.ord_no = oli.ord_no
            WHERE
            obi.customer_id = #{userID}
            AND
            (oli.ord_no LIKE #{condition} OR oli.shipping_address LIKE #{condition} OR oli.receiver LIKE #{condition})
        </if>
        <if test="null != identityType and identityType.toString() == 'DECORATE_MANAGER'">
            SELECT
            obi.`status`,
            obi.ord_no,
            obi.effective_end_time,
            obi.delivery_type
            FROM
            ord_base_info AS obi
            INNER JOIN ord_logistics_info AS oli ON obi.ord_no = oli.ord_no
            WHERE
            obi.manager_id = #{userID}
            AND
            (oli.ord_no LIKE #{condition} OR oli.shipping_address LIKE #{condition} OR oli.receiver LIKE #{condition})
        </if>
        <if test="null != identityType and identityType.toString() == 'SELLER'">
            SELECT
            obi.`status`,
            obi.ord_no,
            obi.effective_end_time,
            obi.delivery_type
            FROM
            ord_base_info AS obi
            INNER JOIN ord_logistics_info AS oli ON obi.ord_no = oli.ord_no
            WHERE
            obi.sales_consult_id = #{userID}
            AND
            (oli.ord_no LIKE #{condition} OR oli.shipping_address LIKE #{condition} OR oli.receiver LIKE #{condition})
        </if>
    </select>

    <select id="getOrderGoodsInfoByOrderNumber" resultType="cn.com.leyizhuang.app.foundation.pojo.order.OrderGoodsInfo">
        SELECT
        *
        FROM
        ord_goods_info
        WHERE
        ord_no = #{orderNumber}
    </select>

    <select id="getAmountPayableByOrderNumber">
        SELECT
        amount_payable
        FROM
        ord_billing_details
        WHERE
        ord_no = #{orderNumber}
    </select>

    <select id="querySumQtyByOrderNumber">
        SELECT sum(order_qty)
        FROM ord_goods_info
        WHERE
        ord_no = #{orderNumber}
    </select>

</mapper>
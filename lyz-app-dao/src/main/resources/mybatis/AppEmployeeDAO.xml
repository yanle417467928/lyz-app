<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.leyizhuang.app.foundation.dao.AppEmployeeDAO">

    <insert id="save" parameterType="AppEmployee">
        INSERT INTO emp_employee (login_name, name, password, salt, identity_type, mobile, birthday,
                                  status, sex, pic_url, city_id, store_id, manager_id, create_time
        ) VALUES (
            #{loginName}, #{name}, #{password}, #{salt},
                          #{employeeType,
            javaType=cn.com.leyizhuang.app.core.constant.AppIdentityType,
            typeHandler=org.apache.ibatis.type.EnumTypeHandler},
                          #{mobile}, #{birthday}, #{status},
                          #{sex,
            javaType=cn.com.leyizhuang.app.core.constant.SexType,
            typeHandler=org.apache.ibatis.type.EnumTypeHandler},
                          #{picUrl}, #{cityId}, #{storeId},#{managerId},#{createTime}
        )
    </insert>
    <select id="findByLoginName" parameterType="java.lang.String" resultType="AppEmployee">
        SELECT *
        FROM emp_employee
        WHERE login_name = #{loginName}
    </select>
    <select id="findByMobile" parameterType="java.lang.String" resultType="AppEmployee">
        SELECT *
        FROM emp_employee
        WHERE mobile = #{mobile}
    </select>
    <update id="update" parameterType="AppEmployee">
        UPDATE emp_employee
        <set>
            <if test="null != name">
                name = #{name},
            </if>
            <if test="null != password">
                password = #{password},
            </if>
            <if test="null != salt">
                salt = #{salt},
            </if>
            <if test="null != identityType">
                identity_type = #{identityType},
            </if>
            <if test="null != mobile">
                mobile = #{mobile},
            </if>
            <if test="null != birthday">
                birthday = #{birthday},
            </if>
            <if test="null != status">
                status = #{status},
            </if>
            <if test="null != sex">
                sex = #{sex,
                javaType=cn.com.leyizhuang.app.core.constant.SexType,
                typeHandler=org.apache.ibatis.type.EnumTypeHandler},
            </if>
            <if test="null != picUrl">
                pic_url = #{pirUrl},
            </if>
            <if test="null != cityId">
                city_id = #{cityId},
            </if>
            <if test="null != storeId">
                store_id = #{storeId},
            </if>
            <if test="null != managerId">
                manager_id = #{managerId},
            </if>
        </set>
        WHERE emp_id = #{empId}
    </update>
    <select id="findByUserId" parameterType="java.lang.Long" resultType="AppEmployee">
        SELECT *
        FROM emp_employee
        WHERE emp_id = (SELECT c.sales_consult_id
                    FROM cus_customer c
                    WHERE c.cus_id = #{userId})
    </select>
    <select id="findById" parameterType="java.lang.Long" resultType="AppEmployee">
        SELECT *
        FROM emp_employee
        WHERE emp_id = #{userId}
    </select>

    <select id="findDecorateEmployeeListByManagerId" parameterType="java.lang.Long"
            resultType="AppEmployee">
        SELECT
        e.name,
        e.mobile,
        e.pic_url,
        e.create_time
        FROM emp_employee e
        WHERE e.identity_type = 'DECORATE_EMPLOYEE'
        AND e.manager_id = #{userId}
    </select>

    <update id="modifyMobileById">
        UPDATE emp_employee
        SET mobile = #{mobile}
        WHERE emp_id = #{id}
    </update>

    <select id="findCreditMoneyBalanceByUserId" parameterType="java.lang.Long" resultType="java.lang.Double">
        SELECT
        balance
        FROM emp_credit_money
        WHERE guide_id = #{userId}
    </select>

    <select id="findEmployeeInfoByUserId" parameterType="java.lang.Long"
            resultType="cn.com.leyizhuang.app.foundation.pojo.response.UserHomePageResponse">
        SELECT
            e.pic_url,
            e.name,
            e.login_name number,
            pd.balance balance
        FROM
            emp_employee e
        INNER JOIN st_store st on e.store_id = st.store_id
        INNER JOIN st_pre_deposit pd ON pd.store_id = st.store_id
        WHERE
            e.emp_id = #{userId}
    </select>
</mapper>
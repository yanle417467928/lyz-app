<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.leyizhuang.app.foundation.dao.MaStoreDAO">

    <resultMap id="storeDetailVOResultMap" type="StoreDetailVO">
        <id property="storeId" column="store_id" jdbcType="BIGINT"/>
        <result property="storeName" column="store_name"/>
        <result property="storeCode" column="store_code"/>
        <result property="storeType" column="store_type"/>
        <result property="enable" column="enable"/>
        <result property="creatorType" column="creator_type"/>
        <result property="createTime" column="create_time"/>
        <result property="modifierType" column="modifier_type"/>
        <result property="modifyTime" column="modify_time"/>
        <result property="phone" column="phone"/>
        <result property="isDefault" column="is_default"/>
        <result property="province" column="province"/>
        <result property="city" column="city"/>
        <result property="area" column="area"/>
        <result property="company" column="fit_compay_type"/>
        <result property="storeOrgId" column="store_org_id"/>
        <result property="detailedAddress" column="detailed_address"/>
        <result property="isSelfDelivery" column="is_self_delivery"/>
        <association property="cityCode" javaType="SimpleCityParam">
            <id property="cityId" column="city_id"/>
            <result property="name" column="name"/>
        </association>
    </resultMap>

    <resultMap id="storeVOResultMap" type="StoreVO">
        <id property="storeId" column="store_id" jdbcType="BIGINT"/>
        <result property="storeName" column="store_name"/>
        <result property="storeCode" column="store_code"/>
        <result property="storeType" column="store_type"/>
        <result property="enable" column="enable"/>
        <result property="enable" column="enable"/>
        <result property="storeOrgId" column="store_org_id"/>
        <association property="cityCode" javaType="SimpleCityParam">
            <id property="cityId" column="city_id"/>
            <result property="name" column="name"/>
        </association>
    </resultMap>


    <resultMap id="storeDOResultMap" type="StoreDO">
        <id property="storeId" column="store_id" jdbcType="BIGINT"/>
        <result property="storeName" column="store_name"/>
        <result property="storeCode" column="store_code"/>
        <result property="storeType" column="store_type"/>
        <result property="enable" column="enable"/>
        <result property="creatorType" column="creator_type"/>
        <result property="createTime" column="create_time"/>
        <result property="modifierType" column="modifier_type"/>
        <result property="modifyTime" column="modify_time"/>
        <result property="phone" column="phone"/>
        <result property="isDefault" column="is_default"/>
        <result property="province" column="province"/>
        <result property="city" column="city"/>
        <result property="area" column="area"/>
        <result property="detailedAddress" column="detailed_address"/>
        <result property="isSelfDelivery" column="is_self_delivery"/>
        <result property="salesManager" column="sales_manager_name"/>
        <result property="company" column="fit_compay_type"/>
        <result property="seller" column="emp.name"/>
        <association property="cityCode" javaType="SimpleCityParam">
            <id property="cityId" column="city_id"/>
            <result property="name" column="name"/>
        </association>
    </resultMap>

    <select id="findAllVO" resultMap="storeVOResultMap">
        SELECT
        s.store_code,
        s.store_name,
        s.enable,
        s.store_type,
        s.store_id,
        s.store_org_id,
        c.name
        FROM
        st_store s
        LEFT JOIN city c ON s.city_code = c.code
        WHERE
        s.store_type!="ZS"
        AND
        s.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
        ORDER BY
        create_time
        DESC
    </select>


    <select id="findStoresVOById" parameterType="java.lang.Long" resultMap="storeDetailVOResultMap">
        SELECT
        s.*,
        c.city_id,
        c.name
        FROM
        st_store s
        LEFT JOIN city c ON s.city_code = c.code
        where s.store_id=#{storeId}
    </select>

    <select id="findStoresListByCityId" parameterType="java.lang.Long"
            resultType="cn.com.leyizhuang.app.foundation.pojo.management.store.SimpleStoreParam">
        SELECT
        s.store_id,
        s.store_name
        FROM
        st_store s
        LEFT JOIN city c on s.city_code = c.code
        WHERE c.city_id = #{cityId}
        AND
        s.store_type!="ZS"
        AND s.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
    </select>

    <select id="findStoresListByCityIdExcludeStoreId"
            resultType="cn.com.leyizhuang.app.foundation.pojo.management.store.SimpleStoreParam">
        SELECT
        s.store_id,
        s.store_name
        FROM
        st_store s
        WHERE
        s.store_type!="ZS"
        and
        s.store_id != #{storeId}
    </select>

    <select id="findAllStoresListByCityId" parameterType="java.lang.Long"
            resultType="cn.com.leyizhuang.app.foundation.pojo.management.store.SimpleStoreParam">
        SELECT
        s.store_id,
        s.store_name
        FROM
        st_store s
        LEFT JOIN city c on s.city_code = c.code
        WHERE c.city_id = #{cityId}
    </select>

    <select id="findStoresList" resultType="cn.com.leyizhuang.app.foundation.pojo.management.store.SimpleStoreParam">
        SELECT
        s.store_id,
        s.store_name
        FROM
        st_store s
        WHERE
        s.store_type!="ZS"
        AND s.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>

    </select>


    <select id="findAllStorelist" resultType="cn.com.leyizhuang.app.foundation.pojo.management.store.SimpleStoreParam">
        SELECT
        s.store_id,
        s.store_name
        FROM
        st_store s
        WHERE
        s.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
    </select>


    <select id="queryStoreListByCityId" resultMap="storeVOResultMap">
        SELECT
        s.store_code,
        s.store_name,
        s.enable,
        s.store_type,
        s.store_id,
        s.store_org_id,
        c.name
        FROM
        st_store s
        LEFT JOIN city c ON s.city_code = c.code
        WHERE c.city_id= #{cityId}
        AND
        s.store_type!="ZS"
        AND
        s.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
    </select>


    <select id="findStoresListByCondition" resultMap="storeVOResultMap">
        SELECT
        s.store_code,
        s.store_name,
        s.enable,
        s.store_type,
        s.store_id,
        s.store_org_id,
        c.name
        FROM
        st_store s
        LEFT JOIN city c ON s.city_code = c.code
        WHERE
        1=1
        <if test="null != cityId">
            AND
            c.city_id= #{cityId}
        </if>
        <if test="null != enabled">
            AND
            s.enable=#{enabled}
        </if>
        AND
        s.store_type!="ZS"
        AND
        s.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
    </select>

    <select id="findStoresListByStoreInfo" parameterType="java.lang.String" resultMap="storeVOResultMap">
        SELECT
        s.store_code,
        s.store_name,
        s.enable,
        s.store_type,
        s.store_id,
        s.store_org_id,
        c.name
        FROM
        st_store s
        LEFT JOIN city c ON s.city_code = c.code
        WHERE s.store_name LIKE CONCAT('%',#{queryStoreInfo},'%') OR s.store_code LIKE CONCAT('%',#{queryStoreInfo},'%')
        AND
        s.store_type!="ZS"
        AND
        s.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
    </select>

    <update id="update">
        UPDATE
        st_store
        <set>
            <if test="null != isSelfDelivery">
                is_self_delivery = #{isSelfDelivery},
            </if>
        </set>
        WHERE store_id = #{storeId}
    </update>

    <select id="queryDecorativeCompanyPageVO"
            resultType="cn.com.leyizhuang.app.foundation.pojo.management.store.StoreDO">
                    SELECT
                s.store_code,
                s.store_name,
                s.ENABLE,
                s.store_id,
                c.NAME AS city,
                s.create_time,
                s.fit_compay_type,
                s.sales_manager_name AS salesManager,
                ss.store_name AS storeNameForCash,
                s.fit_compay_type AS company
                FROM
                st_store s
                LEFT JOIN city c ON s.city_code = c.
                CODE LEFT JOIN emp_employee emp ON emp.emp_id = s.sales_manager
                LEFT JOIN st_store ss ON emp.store_id = ss.store_id
                WHERE
                s.store_type = "ZS"
                ORDER BY
                s.create_time DESC
    </select>

    <select id="queryDecorativeCompanyList" resultMap="storeDOResultMap">
        SELECT
        s.store_code,
        s.store_name,
        s.enable,
        s.store_type,
        s.store_id,
        s.create_time,
        c.name,
        ee.name sales_manager
        FROM
        st_store s
        LEFT JOIN city c ON s.city_code = c.code
        LEFT JOIN emp_employee ee ON ee.emp_id = s.sales_manager
        WHERE
        s.store_type="ZS"
        <if test="fitCompayType !=null and ''!=fitCompayType">
            AND s.fit_compay_type = #{fitCompayType}
        </if>
        <if test="keywords !=null and ''!=keywords">
            AND (
            s.store_code like CONCAT('%', #{keywords}, '%')
            OR
            s.store_name like CONCAT('%', #{keywords}, '%')
            )
        </if>
        <if test="cityId !=null and -1!=cityId">
            AND s.city_id =#{cityId}
        </if>
        AND
        s.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
    </select>


    <select id="queryDecorativeCompanyVOList"
            resultType="cn.com.leyizhuang.app.foundation.pojo.management.decorativeCompany.SimpleDecorativeCompany">
        SELECT
        s.store_name,
        s.store_id as id
        FROM
        st_store s
        WHERE
        s.store_type="ZS"
        ORDER BY
        s.create_time
        DESC
    </select>

    <select id="findDecorativeByCondition" resultType="cn.com.leyizhuang.app.foundation.pojo.management.store.StoreDO">
        SELECT
        s.store_code,
        s.store_name,
        s.enable,
        s.store_id,
        c.name AS city,
        s.create_time,
        s.fit_compay_type,
        s.sales_manager_name as salesManager,
        emp.name as seller,
        s.fit_compay_type AS company
        FROM
        st_store s
        LEFT JOIN city c ON s.city_code = c.code
        LEFT JOIN emp_employee emp ON s.store_id=emp.store_id
        WHERE
        1=1
        <if test="company == ''">
            -- AND status != "INVALID"
        </if>

        <if test="company == 'MONTHLY'">
            and s.fit_compay_type = #{company}
        </if>
        <if test="company == 'CASH'">
            and s.fit_compay_type = #{company}
        </if>
        AND
        s.store_type="ZS"
        <if test="null != cityId">
            AND
            c.city_id= #{cityId}
        </if>
        <if test="null != enabled">
            AND
            s.enable=#{enabled}
        </if>
        ORDER BY
        s.create_time
        DESC
    </select>

    <select id="findDecorativeByInfo" parameterType="java.lang.String" resultMap="storeDOResultMap">
        SELECT
        s.store_code,
        s.store_name,
        s.enable,
        s.store_type,
        s.store_id,
        fit_compay_type,
        c.name
        FROM
        st_store s
        LEFT JOIN city c ON s.city_code = c.code
        WHERE
        s.store_type="ZS"
        AND
        (s.store_name LIKE CONCAT('%',#{queryDecorativeInfo},'%') OR s.store_code LIKE CONCAT('%',#{queryDecorativeInfo},'%'))
         ORDER BY
         s.create_time
         DESC
    </select>

    <select id="findDecorativeById" parameterType="java.lang.Long"
            resultType="cn.com.leyizhuang.app.foundation.pojo.management.store.StoreDO">
        SELECT
        s.store_code,
        s.store_name,
        s.enable,
        s.store_id,
        c.name AS city,
        s.create_time,
        s.fit_compay_type,
		s.sales_manager_name as salesManager,
	    ee.name as seller,
	    s.fit_compay_type AS company
        FROM
        st_store s
        LEFT JOIN city c ON s.city_code = c.code
        LEFT JOIN emp_employee ee ON ee.store_id = s.store_id
        WHERE s.store_id=#{storeId}
        AND
         s.store_type="ZS"
    </select>

    <select id="findDecorativeCreditList"
            resultType="cn.com.leyizhuang.app.foundation.pojo.management.decorativeCompany.DecorativeCompanyInfo">
        SELECT
        s.store_code,
        s.store_name,
        s.enable,
        s.store_id,
        c.name cityName,
        scm.credit_limit_available AS credit,
        ss.balance AS sponsorship,
        scm.credit_limit
        FROM
        st_store s
        LEFT JOIN city c ON s.city_code = c.code
        LEFT JOIN st_credit_money scm on s.store_id=scm.store_id
        LEFT JOIN st_subvention ss on s.store_id=ss.store_id
        WHERE
        s.store_type="ZS"
        ORDER BY
         s.create_time
         DESC
    </select>


    <select id="findDecorativeCreditById" parameterType="java.lang.Long"
            resultType="cn.com.leyizhuang.app.foundation.pojo.management.decorativeCompany.DecorativeCompanyInfo">
        SELECT
        s.store_code,
        s.store_name,
        s.enable,
        s.store_id,
        c.name cityName,
        scm.credit_limit_available AS credit ,
        scm.last_update_time AS creditLastUpdateTime ,
        ss.balance AS sponsorship,
        ss.last_update_time AS sponsorshipLastUpdateTime,
        scm.credit_limit
        FROM
        st_store s
        LEFT JOIN city c ON s.city_code = c.code
        LEFT JOIN st_credit_money scm on s.store_id=scm.store_id
        LEFT JOIN st_subvention ss on s.store_id=ss.store_id
        WHERE
        s.store_id =#{decorativeCompanyId}
        AND
        s.store_type="ZS"
    </select>

    <select id="findDecorativeCreditByInfo"
            resultType="cn.com.leyizhuang.app.foundation.pojo.management.decorativeCompany.DecorativeCompanyInfo">
        SELECT
        s.store_code,
        s.store_name,
        s.enable,
        s.store_id,
        c.name cityName,
        scm.credit_limit_available AS credit,
        ss.balance AS sponsorship,
        scm.credit_limit
        FROM
        st_store s
        LEFT JOIN city c ON s.city_code = c.code
        LEFT JOIN st_credit_money scm on s.store_id=scm.store_id
        LEFT JOIN st_subvention ss on s.store_id=ss.store_id
        WHERE
        s.store_type="ZS"
        AND
        (s.store_name LIKE CONCAT('%',#{queryDecorativeCreditInfo},'%') OR s.store_code LIKE CONCAT('%',#{queryDecorativeCreditInfo},'%'))
        ORDER BY
        s.create_time
        DESC
    </select>


    <select id="findDecorativeCreditByCondition"
            resultType="cn.com.leyizhuang.app.foundation.pojo.management.decorativeCompany.DecorativeCompanyInfo">
        SELECT
        s.store_code,
        s.store_name,
        s.enable,
        s.store_id,
        c.name cityName,
        scm.credit_limit_available AS credit,
        ss.balance AS sponsorship,
        scm.credit_limit
        FROM
        st_store s
        LEFT JOIN city c ON s.city_code = c.code
        LEFT JOIN st_credit_money scm on s.store_id=scm.store_id
        LEFT JOIN st_subvention ss on s.store_id=ss.store_id
        WHERE
        s.store_type="ZS"
        <if test="null != cityId">
            AND
            c.city_id= #{cityId}
        </if>
        <if test="null != enabled">
            AND
            s.enable=#{enabled}
        </if>
        ORDER BY
        s.create_time
        DESC
    </select>

    <select id="findCompanyStoresListByCityId" parameterType="java.lang.Long"
            resultType="cn.com.leyizhuang.app.foundation.vo.management.store.StoreVO">
        SELECT
        s.store_id,
        s.store_name
        FROM
        st_store s
        LEFT JOIN city c on s.city_code = c.code
        WHERE c.city_id = #{cityId}
        AND
        s.store_type = 'ZS'
        AND s.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
    </select>

    <select id="findDecorativeCompanyList" resultType="cn.com.leyizhuang.app.foundation.vo.management.store.StoreVO">
        SELECT
        s.store_id,
        s.store_name
        FROM
        st_store s
        WHERE
        s.store_type = 'ZS'
        AND s.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
    </select>

    <select id="findSelfDeliveryStoresListByCityId" parameterType="java.lang.Long"
            resultType="cn.com.leyizhuang.app.foundation.vo.management.store.StoreVO">
        SELECT
        s.store_id,
        s.store_name
        FROM
        st_store s
        LEFT JOIN city c on s.city_code = c.code
        WHERE c.city_id = #{cityId}
        AND
        s.is_self_delivery = TRUE
    </select>

    <select id="findSelfDeliveryStoresList" resultType="cn.com.leyizhuang.app.foundation.vo.management.store.StoreVO">
        SELECT
        s.store_id,
        s.store_name
        FROM
        st_store s
        WHERE
        s.is_self_delivery = TRUE
    </select>

    <select id="findAllStorePredeposit"
            resultType="cn.com.leyizhuang.app.foundation.vo.management.store.StorePreDepositVO">
        SELECT
        sp.id, sp.balance, s.store_name, s.store_id, s.store_code, c.name city, s.store_type
        FROM st_store s
        LEFT JOIN st_pre_deposit sp on sp.store_id = s.store_id
        LEFT JOIN city c ON c.code = s.city_code
        WHERE
        (1 = 1)
        <if test="null != cityId and cityId != -1">
            AND c.city_id = #{cityId}
        </if>
        <if test="null != storeType and storeType != '-1'">
            AND s.store_type = #{storeType}
        </if>
        <if test="null != keywords and keywords != ''">
            AND (s.store_code LIKE concat(concat('%',#{keywords}),'%')
            OR s.store_name LIKE concat(concat('%',#{keywords}),'%'))
        </if>
        AND s.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
        ORDER BY s.create_time DESC
    </select>

    <select id="queryStorePredepositByStoreId" parameterType="java.lang.Long"
            resultType="cn.com.leyizhuang.app.foundation.vo.management.store.StorePreDepositVO">
         SELECT
        sp.id, sp.balance, s.store_name, s.store_id, s.store_code, c.name city, s.store_type,sp.last_update_time
        FROM st_store s
        LEFT JOIN st_pre_deposit sp on sp.store_id = s.store_id
        LEFT JOIN city c ON c.code = s.city_code
        WHERE s.store_id = #{storeId}
    </select>

    <select id="findByStoreId" parameterType="java.lang.Long"
            resultType="cn.com.leyizhuang.app.foundation.pojo.StorePreDeposit">
        SELECT *
        FROM st_pre_deposit
        WHERE store_id = #{storeId}
    </select>

    <insert id="savePreDeposit" parameterType="cn.com.leyizhuang.app.foundation.pojo.StorePreDeposit">
        INSERT INTO st_pre_deposit (store_id, balance, last_update_time, create_time) VALUES (#{storeId}, #{balance}, #{lastUpdateTime}, #{createTime})
    </insert>

    <update id="updateDepositByStoreId">
        UPDATE st_pre_deposit
        SET balance = balance + #{money},
        last_update_time = #{lastUpdateTime}
        WHERE store_id = #{storeId}
        <if test="null != oldUpdateTime">
            AND last_update_time = #{oldUpdateTime}
        </if>
    </update>


    <select id="findStoreByStoreCode" parameterType="java.lang.String"
            resultType="cn.com.leyizhuang.app.foundation.pojo.management.store.MaStoreInfo">
        SELECT *
        FROM st_store
        WHERE store_code = #{storeCode}
    </select>


    <update id="updateStPreDepositByUserIdAndVersion">
        UPDATE st_pre_deposit
        SET
        balance = #{money}
        WHERE
        store_id = #{userId}
        AND last_update_time = #{version}
    </update>


    <insert id="saveStorePreDepositLog" parameterType="cn.com.leyizhuang.app.foundation.pojo.StPreDepositLogDO">
        INSERT INTO st_pre_deposit_log
        (create_time, change_money, remarks, change_type, store_id, operator_id, operator_type,
        operator_ip, order_number, balance, detail_reason, transfer_time, merchant_order_number)
        VALUES
        (#{createTime}, #{changeMoney}, #{remarks}, #{changeType}, #{storeId}, #{operatorId}, #{operatorType},
        #{operatorIp}, #{orderNumber}, #{balance}, #{detailReason}, #{transferTime}, #{merchantOrderNumber})
    </insert>

    <select id="findAllStoreVO" resultMap="storeVOResultMap">
        SELECT
        s.store_code,
        s.store_name,
        s.store_type,
        s.store_id,
        c.name
        FROM
        st_store s
        LEFT JOIN city c ON s.city_code = c.code
        WHERE
        s.enable IS TRUE
        <if test="null != cityId and cityId != -1">
            AND c.city_id = #{cityId}
        </if>
        <if test="null != storeType and storeType != '-1'">
            AND s.store_type = #{storeType}
        </if>
        <if test="null != keywords and keywords != ''">
            AND (s.store_code LIKE concat(concat('%',#{keywords}),'%')
            OR s.store_name LIKE concat(concat('%',#{keywords}),'%'))
        </if>
        ORDER BY
        s.create_time
        DESC
    </select>

    <select id="findStoresListByCityIdAndStoreId"
            resultType="cn.com.leyizhuang.app.foundation.pojo.management.store.SimpleStoreParam">
        SELECT
        s.store_id,
        s.store_name
        FROM
        st_store s
        LEFT JOIN city c on s.city_code = c.code
        WHERE (1 = 1)
        <if test="null != cityId and cityId != -1">
            AND c.city_id = #{cityId}
        </if>
        AND s.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
    </select>


    <select id="findSmallFitAndStoresListByCityIdAndStoreId"
            resultType="cn.com.leyizhuang.app.foundation.pojo.management.store.SimpleStoreParam">
        SELECT
        ss.store_id,
        ss.store_name
        FROM
        st_store ss
        LEFT JOIN city c ON ss.city_code = c.CODE
        WHERE
        ss.store_type ='ZY'
        <if test="null != cityId and cityId != -1">
            AND c.city_id = #{cityId}
        </if>
        AND ss.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>

        UNION

        SELECT
        ss.store_id,
        ss.store_name
        FROM
        st_store ss
        LEFT JOIN city c ON ss.city_code = c.CODE
        WHERE
        ss.store_type ='JM'
        <if test="null != cityId and cityId != -1">
            AND c.city_id = #{cityId}
        </if>
        AND ss.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>

        UNION

        SELECT
        ss.store_id,
        ss.store_name
        FROM
        st_store ss
        LEFT JOIN city c ON ss.city_code = c.CODE
        WHERE
        ss.store_type ='ZS'
        AND
        ss.fit_compay_type ='CASH'
        <if test="null != cityId and cityId != -1">
            AND c.city_id = #{cityId}
        </if>
        AND ss.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>

        UNION

        SELECT
        ss.store_id,
        ss.store_name
        FROM
        st_store ss
        LEFT JOIN city c ON ss.city_code = c.CODE
        WHERE
        ss.store_type ='FX'
        <if test="null != cityId and cityId != -1">
            AND c.city_id = #{cityId}
        </if>
        AND ss.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>

    </select>


    <select id="findSmallFitStoresListByStoreIdNotBillRule"
            resultType="cn.com.leyizhuang.app.foundation.pojo.management.store.SimpleStoreParam">
        SELECT
        s.store_id,
        s.store_name
        FROM
        st_store s
        LEFT JOIN
        bill_rule br ON s.store_id = br.store_id
        WHERE
        s.store_type ='ZS'
        AND s.fit_compay_type ='CASH'
        AND br.id is NULL
        AND s.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
    </select>

    <select id="findStoresListByStoreId"
            resultType="cn.com.leyizhuang.app.foundation.pojo.management.store.SimpleStoreParam">
        SELECT
        s.store_id,
        s.store_name
        FROM
        st_store s
        WHERE
        s.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
    </select>


    <select id="findFitAndStoresListByStoreId"
            resultType="cn.com.leyizhuang.app.foundation.pojo.management.store.SimpleStoreParam">
        SELECT
        s.store_id,
        s.store_name
        FROM
        st_store s
        WHERE
        1=1
        <if test="null != cityId and cityId != -1">
            AND s.city_id = #{cityId}
        </if>
        <choose>
            <when test="'ZS'==storeType">
                and (s.store_type = 'ZS' AND s.fit_compay_type = 'CASH' )
            </when>
            <otherwise>
                <if test="null!=storeType and ''!=storeType and '-1' != storeType">
                    and s.store_type =#{storeType}
                </if>
            </otherwise>
        </choose>
        AND
        s.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
    </select>

    <select id="findAppStoreByStoreId" parameterType="java.lang.Long"
            resultType="cn.com.leyizhuang.app.foundation.pojo.AppStore">
        SELECT city_id, store_id, store_type, store_name FROM st_store WHERE store_id = #{storeId}
    </select>

    <select id="findStoresListByStoreIdAndStoreType"
            resultType="cn.com.leyizhuang.app.foundation.pojo.management.store.SimpleStoreParam">
        SELECT
        s.store_id,
        s.store_name
        FROM
        st_store s
        WHERE
        s.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
        AND s.store_type IN
        <foreach collection="storeTypes" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
    </select>

    <select id="findSmallFitStoresListByStoreId"
            resultType="cn.com.leyizhuang.app.foundation.pojo.management.store.SimpleStoreParam">
        SELECT
        s.store_id,
        s.store_name
        FROM
        st_store s
        WHERE
        s.store_type ='ZS'
        AND
        s.fit_compay_type='CASH'
        AND
        s.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
    </select>

    <select id="findCityIdByStoreId" parameterType="java.lang.Long" resultType="java.lang.Long">
        SELECT city_id FROM st_store WHERE store_id = #{storeId}
    </select>


    <select id="findStoresListByCityIdAndStoreType"
            resultType="cn.com.leyizhuang.app.foundation.pojo.management.store.SimpleStoreParam">
        SELECT
        s.store_id,
        s.store_name
        FROM
        st_store s
        LEFT JOIN city c on s.city_code = c.code
        WHERE (1 = 1)
        <if test="null != cityId and cityId != -1">
            AND c.city_id = #{cityId}
        </if>
        <if test="null != storeType and storeType != ''">
            AND s.store_type = #{storeType}
        </if>
        AND s.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
    </select>

    <select id="findAllStoresListByCityIdAndStoreType"
            resultType="cn.com.leyizhuang.app.foundation.pojo.management.store.SimpleStoreParam">
        SELECT
        s.store_id,
        s.store_name
        FROM
        st_store s
        LEFT JOIN city c on s.city_code = c.code
        WHERE (1 = 1)
        <if test="null != cityId and cityId != -1">
            AND c.city_id = #{cityId}
        </if>
        <if test="null != storeType and storeType != ''">
            AND s.store_type = #{storeType}
        </if>
    </select>


    <select id="findStoresIdByStructureCode"
            resultType="java.lang.Long">
        SELECT
        s.store_id
        FROM
        st_store s
        WHERE
        1=1
        <if test="null!=structureCode and ''!=structureCode">
            AND s.store_structure_code like concat('%',#{structureCode},'%')
        </if>

    </select>


    <select id="findFitCompanyIdByStoreId"
            resultType="java.lang.Long">
        SELECT
        DISTINCT
        s.store_id
        FROM
        st_store s
        LEFT JOIN
        emp_employee e ON s.sales_manager = e.emp_id
        WHERE
        s.store_type = 'ZS'
        AND s.sales_manager IS NOT NULL
        AND s.fit_compay_type ='CASH'
        AND
        e.store_id in
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
    </select>


    <select id="exsitStoreInCompany"
            resultType="java.lang.Boolean">
     SELECT EXISTS (  SELECT
        1
        FROM
        st_store s
        WHERE
        store_id=#{storeId}
        AND
        store_structure_code  LIKE CONCAT(CONCAT('%', #{companyCode}), '%')
        AND
        store_type=#{storeType}
        )

    </select>


    <select id="findFitCompanyIdBySellerId"
            resultType="java.lang.Long">
        SELECT
        store_id
        FROM
        st_store s
        WHERE
        sales_manager=#{id}
        AND
       fit_compay_type='CASH'
    </select>


    <select id="findStoresListByCompanyCodeAndStoreType"
            resultType="cn.com.leyizhuang.app.foundation.pojo.management.store.SimpleStoreParam">
        SELECT
        s.store_id,
        s.store_name
        FROM
        st_store s
        WHERE
        1=1
        <choose>
            <when test="'FX'==storeType">
                and s.store_type in ('FX','FXCK')
            </when>
            <when test="'ZS'==storeType">
                and ((s.store_type =#{storeType} AND s.fit_compay_type = "MONTHLY")
                or
                (s.store_structure_code like concat("%|JZC001|%") and s.store_type = 'ZY' ))
            </when>
            <otherwise>
                <if test="null!=storeType and ''!=storeType">
                    and s.store_type =#{storeType}
                </if>
            </otherwise>
        </choose>
        <if test="null != companyCode and ''!=companyCode and 'ALL' != companyCode">
            AND s.store_structure_code like concat('%',#{companyCode},'%')
        </if>
        AND s.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
    </select>


    <select id="findStoresListByCompanyCodeAndStoreTypeForSale"
            resultType="cn.com.leyizhuang.app.foundation.pojo.management.store.SimpleStoreParam">
        SELECT
        s.store_id,
        s.store_name
        FROM
        st_store s
        WHERE
        1=1
        <choose>
            <when test="'FXAll'==storeType">
                and s.store_type in ('FX','FXCK')
            </when>
            <when test="'ZS'==storeType">
                and ((s.store_type =#{storeType} AND s.fit_compay_type = "MONTHLY")
                or
                (s.store_structure_code like concat("%|JZC001|%") and s.store_type = 'ZY' ))
            </when>
            <otherwise>
                <if test="null!=storeType and ''!=storeType">
                    and s.store_type =#{storeType}
                </if>
            </otherwise>
        </choose>
        <if test="null != companyCode and ''!=companyCode and 'ALL' != companyCode">
            AND s.store_structure_code like concat('%',#{companyCode},'%')
        </if>
        AND s.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
    </select>


    <select id="findStoresIdByStructureCodeAndStoreType"
            resultType="java.lang.Long">
        SELECT
        s.store_id
        FROM
        st_store s
        WHERE
        1=1
        <choose>
            <when test="'FX'==storeType">
                and s.store_type in ('FX','FXCK')
            </when>
            <when test="'ZS'==storeType">
                and ((s.store_type =#{storeType} AND s.fit_compay_type = "MONTHLY")
                or
                (s.store_structure_code like concat("%|JZC001|%") and s.store_type = 'ZY' ))
            </when>
            <otherwise>
                <if test="null!=storeType and ''!=storeType">
                    and s.store_type =#{storeType}
                </if>
            </otherwise>
        </choose>
        <if test="null != structureCode and ''!=structureCode">
            AND s.store_structure_code like concat('%',#{structureCode},'%')
        </if>
    </select>


    <select id="queryDecorativeCreditChangePage"
            resultType="cn.com.leyizhuang.app.foundation.vo.management.decorativeCompany.FitCreditMoneyChangeLogVO">
        SELECT
        l.store_id ,
        l.create_time ,
        l.change_amount ,
        l.credit_limit_available_after_change ,
        l.reference_number ,
        l.change_type ,
        l.change_type_desc ,
        l.operator_id ,
        l.operator_type ,
        l.operator_ip ,
        l.remark,
        s.store_name,
        s.store_code,
        s.fit_compay_type as storeType,
        CASE l.operator_type
        when 'DECORATE_MANAGER' then e.`name`
        WHEN 'DECORATE_MANAGER' THEN e.`name`
        WHEN 'DECORATE_EMPLOYEE' THEN e.`name`
        WHEN 'SELLER' THEN e.`name`
        when 'CUSTOMER' then cu.`name`
        when 'ADMINISTRATOR' then au.`name` end as operatorName
        FROM st_credit_money_change_log l
        LEFT JOIN st_store s on l.store_id =s.store_id
        LEFT JOIN admin_user au on au.uid = l.operator_id
        LEFT JOIN cus_customer cu on cu.cus_id = l.operator_id
        LEFT JOIN emp_employee e on e.emp_id = l.operator_id
        where
        l.store_id =#{storeId}
        <if test="null != keywords and ''!=keywords">
            AND reference_number=#{keywords}
        </if>
        <if test="null != changeType and ''!=changeType">
            AND change_type=#{changeType}
        </if>
        ORDER BY l.create_time DESC
    </select>

    <select id="queryLastDecorativeCreditChange"
            resultType="cn.com.leyizhuang.app.foundation.vo.management.decorativeCompany.FitCreditMoneyChangeLogVO">
        SELECT
        l.store_id ,
        l.create_time ,
        l.change_amount ,
        l.credit_limit_available_after_change ,
        l.reference_number ,
        l.change_type ,
        l.change_type_desc ,
        l.operator_id ,
        l.operator_type ,
        l.operator_ip ,
        l.remark,
        s.store_name,
        s.store_code,
        s.fit_compay_type as storeType,
        CASE l.operator_type
				when 'DECORATE_MANAGER' then e.`name`
				WHEN 'DECORATE_MANAGER' THEN e.`name`
                WHEN 'DECORATE_EMPLOYEE' THEN e.`name`
                WHEN 'SELLER' THEN e.`name`
				when 'CUSTOMER' then cu.`name`
				when 'ADMINISTRATOR' then au.`name` end as operatorName
        FROM st_credit_money_change_log l
        LEFT JOIN st_store s on l.store_id =s.store_id
        LEFT JOIN admin_user au on au.uid = l.operator_id
        LEFT JOIN cus_customer cu on cu.cus_id = l.operator_id
        LEFT JOIN emp_employee e on e.emp_id = l.operator_id
        where
        l.store_id =#{storeId}
        ORDER BY l.create_time DESC limit 1
    </select>
    <select id="queryLastStoreChange"

            resultType="cn.com.leyizhuang.app.foundation.vo.management.store.StorePreDepositLogVO">
        SELECT
        l.store_id ,
        l.create_time ,
        l.change_money ,
        l.change_type ,
        l.change_type_desc ,
        l.operator_id ,
        l.operator_type ,
        l.operator_ip ,
        s.store_name,
        s.store_code,
        CASE l.operator_type
        WHEN 'DECORATE_MANAGER' THEN
        e.`name`
        WHEN 'DECORATE_EMPLOYEE' THEN
        e.`name`
        WHEN 'SELLER' THEN
        e.`name`
        WHEN 'CUSTOMER' THEN
        cu.`name`
        WHEN 'ADMINISTRATOR' THEN
        au.`name`
        END AS operatorName
        FROM
        st_pre_deposit_log l
        LEFT JOIN st_store s ON l.store_id = s.store_id
        LEFT JOIN admin_user au ON au.uid = l.operator_id
        LEFT JOIN cus_customer cu ON cu.cus_id = l.operator_id
        LEFT JOIN emp_employee e ON e.emp_id = l.operator_id
        WHERE
        l.store_id =#{storeId}
        ORDER BY
        l.create_time DESC
        LIMIT 1
    </select>

</mapper>
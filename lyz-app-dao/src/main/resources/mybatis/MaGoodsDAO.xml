<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.leyizhuang.app.foundation.dao.MaGoodsDAO">

    <insert id="saveGoodsShippingInfo" parameterType="cn.com.leyizhuang.app.foundation.pojo.management.goods.GoodsShippingInfo">
        INSERT
        INTO
        gds_goods_shipping_log (gid,sku,price,sku_name,shipping_time,qty,change_type,change_type_desc,reference_number,creator,delivery_type,store,city)
        VALUES
        (#{gid},#{sku},#{price},#{skuName},#{shippingTime},#{qty},#{changeType},#{changeTypeDesc},#{referenceNumber},#{creator},#{deliveryType},#{store},#{city})
    </insert>
    
    <select id="findGoodsByCidAndCusId" resultType="cn.com.leyizhuang.app.foundation.vo.management.goods.GoodsResponseVO">
        SELECT
            g.cover_image_uri,
            g.sku_name goods_name,
            g.gid id,
            g.goods_specification,
            g.goods_unit,
            p.vip_price,
            p.retail_price,
            g.category_name categoryName,
            g.brd_id brand_id,
            g.type_name typeName,
            g.sku
        FROM
            cus_customer c
            INNER JOIN gds_goods_price p ON c.store_id = p.store_id
                                            AND p.start_time &lt; NOW()
                                            AND (p.end_time IS NULL OR p.end_time &gt; NOW())
            INNER JOIN gds_goods g ON p.gid = g.gid
        WHERE
            c.cus_id = #{cusId}
            AND g.cid IN
            <foreach collection="list" item="cid" open="(" close=")" separator=",">
                #{cid}
            </foreach>

    </select>

    <select id="findGoodsByCidAndEmpId" resultType="cn.com.leyizhuang.app.foundation.vo.management.goods.GoodsResponseVO">
        SELECT
            g.cover_image_uri,
            g.sku_name goods_name,
            g.gid id,
            g.goods_specification,
            g.goods_unit,
            p.vip_price,
            p.retail_price,
            g.category_name categoryName,
            g.brd_id brand_id,
            g.type_name typeName,
            g.sku
        FROM
          emp_employee e
        INNER JOIN gds_goods_price p ON e.store_id = p.store_id
        AND p.start_time &lt; NOW()
        AND (p.end_time IS NULL OR p.end_time &gt; NOW())
        INNER JOIN gds_goods g ON p.gid = g.gid
        WHERE
          e.emp_id = #{empId}
        AND g.cid IN
        <foreach collection="list" item="cid" open="(" close=")" separator=",">
            #{cid}
        </foreach>
    </select>

    <select id="findGoodsById" parameterType="java.lang.Long"
            resultType="cn.com.leyizhuang.app.foundation.pojo.goods.GoodsDO">
        SELECT
        gid,
        sku,
        sku_name,
        cover_image_uri,
        goods_specification,
        goods_unit,
        brd_id,
        company_flag
        FROM gds_goods
        WHERE gid = #{gid}
    </select>
    
</mapper>
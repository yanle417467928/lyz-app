<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.leyizhuang.app.foundation.dao.PaymentDataDAO">

    <insert id="save" parameterType="cn.com.leyizhuang.app.foundation.pojo.PaymentDataDO">
        INSERT INTO payment_data
        (create_time, user_id, identity_type, out_trade_no, trade_status, payment_type, payment_type_desc, total_fee,
         online_pay_type, notify_url, notify_time, trade_no, remarks)
        VALUES
            (#{createTime}, #{userId}, #{appIdentityType}, #{outTradeNo}, #{tradeStatus}, #{paymentType},
                            #{paymentTypeDesc},
                            #{totalFee}, #{onlinePayType}, #{notifyUrl}, #{notifyTime}, #{trade_no}, #{remarks})
    </insert>


    <select id="findByOutTradeNoAndTradeStatus"
            resultType="cn.com.leyizhuang.app.foundation.pojo.PaymentDataDO">
        SELECT
            id,
            out_trade_no,
            total_fee,
            trade_status,
            user_id,
            identity_type appIdentityType,
            payment_type
        FROM payment_data
        WHERE out_trade_no = #{outTradeNo}
              AND trade_status = #{tradeStatus}
        ORDER BY id DESC
    </select>

    <update id="updateByTradeStatusIsWaitPay" parameterType="cn.com.leyizhuang.app.foundation.pojo.PaymentDataDO">
        UPDATE payment_data
        <set>
            <if test="null != tradeNo">
                trade_no = #{tradeNo},
            </if>
            <if test="null != tradeStatus">
                trade_status = #{tradeStatus},
            </if>
        </set>
        WHERE out_trade_no = #{outTradeNo}
        AND id = #{id}
        AND trade_status = 'WAIT_PAY'
    </update>

</mapper>
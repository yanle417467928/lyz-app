<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.leyizhuang.app.foundation.dao.BrowseHistoryDAO">

    <insert id="save" parameterType="cn.com.leyizhuang.app.foundation.pojo.request.BrowseHistoryRequest">
        INSERT INTO browse_history
        (user_id, identity_type, goods_id, create_time)
        VALUES
        (#{userId}, #{identityType}, #{goodsId}, #{createTime})
    </insert>

    <delete id="delete">
        DELETE FROM browse_history
        WHERE id in
              (SELECT id FROM
                (SELECT id FROM browse_history
                WHERE user_id = #{userId} AND identity_type = #{identityType}
                ORDER BY id DESC
                LIMIT 20, 3
                ) AS temp
              )
    </delete>

    <select id="existBrowseHistory" resultType="java.lang.Long">
        SELECT id FROM browse_history
        WHERE user_id = #{userId} AND identity_type = #{identityType} AND goods_id = #{goodsId}
    </select>

    <delete id="delete">
        DELETE FROM browse_history
        WHERE id in
        <foreach collection="list" item="id" open="(" close=")" separator=",">
            #{id}
        </foreach>
    </delete>

</mapper>
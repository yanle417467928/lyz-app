<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.leyizhuang.app.foundation.dao.AppSeparateOrderDAO">

    <select id="isOrderExist" parameterType="java.lang.String" resultType="java.lang.Boolean">
        SELECT exists(SELECT 1
                      FROM inter_ate_order_base_inf
                      WHERE main_order_number = #{orderNumber})
    </select>

    <insert id="saveOrderBaseInf"
            parameterType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.OrderBaseInf"
            useGeneratedKeys="true" keyProperty="orderHeaderId">
        INSERT INTO inter_ate_order_base_inf (create_time, order_subject_type, send_flag, error_msg, send_time,
                                              main_order_number, order_number,
                                              sob_id, order_date, product_type, order_type_id, user_id, sales_consult_id,
                                              coupon_flag, invoice_flag, credit_flag, store_org_id, diy_site_code, delivery_type_title,
                                              order_amt, rec_amt, lebi_discount, store_subvention_discount, promotion_discount,
                                              member_discount, cash_coupon_discount, product_coupon_discount)
        VALUES (
            #{createTime}, #{orderSubjectType}, #{sendFlag}, #{errorMsg}, #{sendTime}, #{mainOrderNumber},
                           #{orderNumber}, #{sobId},
                           #{orderDate}, #{productType},
                           #{orderTypeId}, #{userId}, #{salesConsultId}, #{couponFlag}, #{invoiceFlag}, #{creditFlag},
                                           #{storeOrgId}, #{diySiteCode}, #{deliveryTypeTitle},
                                           #{orderAmt}, #{recAmt}, #{lebiDiscount},
            #{storeSubventionDiscount}, #{promotionDiscount}, #{memberDiscount}, #{cashCouponDiscount},
            #{productCouponDiscount}
        )
    </insert>

    <insert id="saveOrderGoodsInf"
            parameterType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.OrderGoodsInf">
        INSERT INTO inter_ate_order_goods_inf (order_header_id, create_time, send_flag, error_msg, send_time, main_order_line_id, main_order_number, order_number,
                                               sku, goods_title, quantity, ls_price,
                                               hy_price, jx_price, settlement_price, return_price, lebi_discount, subvention_discount,
                                               cash_coupon_discount, promotion_discount, discount_total_price, gift_flag, promotion_id, product_type)
        VALUES
            (#{orderHeaderId}, #{createTime}, #{sendFlag}, #{errorMsg}, #{sendTime}, #{mainOrderLineId},
                               #{mainOrderNumber},
                               #{orderNumber},
                               #{sku}, #{goodsTitle}, #{quantity}, #{lsPrice}, #{hyPrice},
                                                                   #{jxPrice}, #{settlementPrice},
                                                                   #{returnPrice}, #{lebiDiscount},
                                                                   #{subventionDiscount},
                                                                   #{cashCouponDiscount},
                                                                   #{promotionDiscount},
                                                                   #{discountTotalPrice}, #{giftFlag},
             #{promotionId}, #{productType})
    </insert>

    <insert id="saveOrderCouponInf"
            parameterType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.OrderCouponInf">
        INSERT INTO inter_ate_order_coupon_inf (main_order_number, create_time, send_flag, error_msg, send_time, history_flag,
                                                get_type, product_type, buy_price, cost_price, coupon_id, sku, quantity, coupon_type_id,
                                                sob_id, promotion, attribute1, attribute2, attribute3, attribute4)
        VALUES (#{mainOrderNumber}, #{createTime}, #{sendFlag}, #{errorMsg}, #{sendTime}, #{historyFlag}, #{getType},
                                    #{productType}, #{buyPrice},
                                    #{costPrice}, #{couponId}, #{sku}, #{quantity}, #{couponTypeId}, #{sobId},
                #{promotion},
                #{attribute1}, #{attribute2}, #{attribute3}, #{attribute4})
    </insert>

    <insert id="saveOrderReceiptInf"
            parameterType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.OrderReceiptInf">
        INSERT INTO inter_ate_order_receipt_inf (create_time, send_flag, error_msg, send_time, main_order_number, receipt_number,
                                                 receipt_type, store_org_id, diy_site_code, receipt_date, amount, description,
                                                 sob_id, user_id, username, user_phone, guide_id, attribute1, attribute2, attribute3, attribute4, attribute5)
            SELECT
                #{createTime},
                #{sendFlag},
                #{errorMsg},
                #{sendTime},
                #{mainOrderNumber},
                #{receiptNumber},
                #{receiptType},
                #{storeOrgId},
                #{diySiteCode},
                #{receiptDate},
                #{amount},
                #{description},
                #{sobId},
                #{userId},
                #{username},
                #{userPhone},
                #{guideId},
                #{attribute1},
                #{attribute2},
                #{attribute3},
                #{attribute4},
                #{attribute5}
            FROM dual
            WHERE NOT exists(SELECT 1
                             FROM inter_ate_order_receipt_inf
                             WHERE receipt_number = #{receiptNumber})
    </insert>

    <select id="getPendingSendOrderBaseInf" parameterType="java.lang.String" resultType=
            "cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.OrderBaseInf">
        SELECT
            order_header_id,
            create_time,
            send_flag,
            error_msg,
            send_time,
            main_order_number,
            order_number,
            sob_id,
            order_date,
            order_subject_type,
            product_type,
            order_type_id,
            user_id,
            sales_consult_id,
            decorate_manager_id,
            coupon_flag,
            invoice_flag,
            credit_flag,
            store_org_id,
            diy_site_code,
            delivery_type_title,
            order_amt,
            rec_amt,
            lebi_discount,
            store_subvention_discount,
            promotion_discount,
            member_discount,
            cash_coupon_discount,
            product_coupon_discount,
            attribute1,
            attribute2,
            attribute3,
            attribute4,
            attribute5,
            attribute6,
            attribute7
        FROM inter_ate_order_base_inf
        WHERE main_order_number = #{orderNumber}
    </select>

    <select id="getOrderGoodsInfByOrderNumber" parameterType="java.lang.String" resultType=
            "cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.OrderGoodsInf">
        SELECT
            order_line_id,
            order_header_id,
            create_time,
            send_flag,
            send_time,
            error_msg,
            main_order_line_id,
            main_order_number,
            order_number,
            sku,
            goods_title,
            quantity,
            ls_price,
            hy_price,
            jx_price,
            settlement_price,
            return_price,
            lebi_discount,
            subvention_discount,
            cash_coupon_discount,
            promotion_discount,
            discount_total_price,
            gift_flag,
            promotion_id,
            product_type,
            attribute1,
            attribute2,
            attribute3,
            attribute4
        FROM inter_ate_order_goods_inf
        WHERE order_number = #{orderNumber}
    </select>

    <update id="updateOrderBaseInfSendFlagAndErrorMessageAndSendTime">
        UPDATE inter_ate_order_base_inf
        <set>
            <if test="null != flag">
                send_flag = #{flag},
            </if>
            <if test="null != errorMsg">
                error_msg = #{errorMsg},
            </if>
            <if test="null != sendTime">
                send_time = #{sendTime}
            </if>
        </set>
        WHERE order_number = #{orderNumber}
    </update>

    <update id="updateOrderGoodsInfoSendFlagAndErrorMessageAndSendTime">
        UPDATE inter_ate_order_goods_inf
        <set>
            <if test="null != flag">
                send_flag = #{flag},
            </if>
            <if test="null != errorMsg">
                error_msg = #{errorMsg},
            </if>
            <if test="null != sendTime">
                send_time = #{sendTime}
            </if>
        </set>
        WHERE order_line_id = #{orderLineId}
    </update>

    <select id="getOrderBillingPaymentDetailsByOrderNumber" parameterType="java.lang.String"
            resultType="cn.com.leyizhuang.app.foundation.pojo.order.OrderBillingPaymentDetails">
        SELECT
            id,
            oid    order_id,
            ord_no order_number,
            create_time,
            pay_time,
            pay_type,
            pay_type_desc,
            payment_subject_type,
            payment_subject_type_desc,
            amount,
            reply_code,
            receipt_number
        FROM ord_billing_payment_details
        WHERE ord_no = #{orderNumber}
    </select>

    <select id="getOrderReceiptInf" parameterType="java.lang.String"
            resultType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.OrderReceiptInf">
        SELECT
            receipt_id,
            create_time,
            send_flag,
            error_msg,
            send_time,
            main_order_number,
            receipt_number,
            receipt_type,
            store_org_id,
            diy_site_code,
            receipt_date,
            amount,
            description,
            sob_id,
            user_id,
            username,
            user_phone,
            guide_id,
            attribute1,
            attribute2,
            attribute3,
            attribute4,
            attribute5
        FROM inter_ate_order_receipt_inf
        WHERE main_order_number = #{orderNumber}
    </select>

    <select id="getOrderCouponInf" parameterType="java.lang.String"
            resultType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.OrderCouponInf">
        SELECT
            id,
            main_order_number,
            create_time,
            send_flag,
            error_msg,
            send_time,
            history_flag,
            get_type,
            product_type,
            buy_price,
            cost_price,
            coupon_id,
            sob_id,
            sku,
            quantity,
            coupon_type_id,
            attribute1,
            attribute2,
            attribute3,
            attribute4,
            promotion
        FROM inter_ate_order_coupon_inf
        WHERE main_order_number = #{orderNumber}
    </select>

    <update id="updateOrderCouponFlagAndSendTimeAndErrorMsg">
        UPDATE inter_ate_order_coupon_inf
        <set>
            <if test="null != flag">
                send_flag = #{flag},
            </if>
            <if test="null != sendTime">
                send_time = #{sendTime},
            </if>
            <if test="null != msg">
                error_msg = #{msg}
            </if>
        </set>
        WHERE id in
        <foreach collection="couponInfIds" item="id" index="index" open="(" close=")" separator=",">
            #{id}
        </foreach>
    </update>

    <update id="updateOrderGoodsInfByOrderNumber">
        UPDATE inter_ate_order_goods_inf
        <set>
            <if test="null != flag">
                send_flag = #{flag},
            </if>
            <if test="null != errorMsg">
                error_msg = #{errorMsg},
            </if>
            <if test="null != sendTime">
                send_time = #{sendTime}
            </if>
        </set>
        WHERE order_number = #{orderNumber}
    </update>

    <update id="updateOrderReceiptFlagAndSendTimeAndErrorMsg">
        UPDATE inter_ate_order_receipt_inf
        <set>
            <if test="null != flag">
                send_flag = #{flag},
            </if>
            <if test="null != sendTime">
                send_time = #{sendTime},
            </if>
            <if test="null != errorMsg">
                error_msg = #{errorMsg}
            </if>
        </set>
        WHERE receipt_id in
        <foreach collection="receiptInfIds" open="(" close=")" separator="," item="id" index="index">
            #{id}
        </foreach>
    </update>

    <select id="isRechargeReceiptExist" parameterType="java.lang.String" resultType="java.lang.Boolean">
        SELECT exists(SELECT 1
                      FROM inter_ate_recharge_receipt_inf
                      WHERE charge_number = #{rechargeNo})
    </select>

    <insert id="saveRechargeReceiptInf"
            parameterType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.RechargeReceiptInf">
        INSERT INTO inter_ate_recharge_receipt_inf (charge_number, sob_id, charge_obj, charge_type, receiptType,
                                                    userid, store_org_code, diy_site_code, receipt_date, amount, description, attribute1,
                                                    attribute2, attribute3, attribute4, attribute5, create_time, send_flag, error_msg, send_time,
                                                    receipt_number)
            SELECT
                #{chargeNumber},
                #{sobId},
                #{chargeObj},
                #{chargeType},
                #{receiptType},
                #{userid},
                #{storeOrgCode},
                #{diySiteCode},
                #{receiptDate},
                #{amount},
                #{description},
                #{attribute1},
                #{attribute2},
                #{attribute3},
                #{attribute4},
                #{attribute5},
                #{createTime},
                #{sendFlag},
                #{errorMsg},
                #{sendTime},
                #{receiptNumber}
            FROM dual
            WHERE NOT exists(SELECT 1
                             FROM inter_ate_recharge_receipt_inf
                             WHERE charge_number = #{chargeNumber})
    </insert>

    <select id="getRechargeReceiptInfByRechargeNo" parameterType="java.lang.String"
            resultType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.RechargeReceiptInf">
        SELECT
            receipt_id,
            charge_number,
            sob_id,
            charge_obj,
            charge_type,
            receiptType,
            userid,
            store_org_code,
            diy_site_code,
            receipt_date,
            amount,
            description,
            attribute1,
            attribute2,
            attribute3,
            attribute4,
            attribute5,
            create_time,
            send_flag,
            error_msg,
            send_time,
            receipt_number
        FROM inter_ate_recharge_receipt_inf
        WHERE charge_number = #{rechargeNo}
    </select>

    <update id="updateRechargeReceiptFlagAndSendTimeAndErrorMsg">
        UPDATE inter_ate_recharge_receipt_inf
        <set>
            <if test="null != flag">
                send_flag = #{flag},
            </if>
            <if test="null != msg">
                error_msg = #{msg},
            </if>
            <if test="null != sendTime">
                send_time = #{sendTime}
            </if>
        </set>
        WHERE receipt_id = #{receiptId}
    </update>

    <insert id="saveOrderJxPriceDifferenceReturnInf"
            parameterType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.OrderJxPriceDifferenceReturnInf">
        INSERT INTO inter_ate_order_jx_price_difference_return_inf (main_order_number, sob_id, store_org_code, diy_site_code, receipt_date, sku,
                                                                    amount, description, attribute1, attribute2, attribute3, attribute4, attribute5,
                                                                    create_time, send_flag, error_msg, send_time, receipt_number)
            SELECT
                #{mainOrderNumber},
                #{sobId},
                #{storeOrgCode},
                #{diySiteCode},
                #{receiptDate},
                #{sku},
                #{amount},
                #{description},
                #{attribute1},
                #{attribute2},
                #{attribute3},
                #{attribute4},
                #{attribute5},
                #{createTime},
                #{sendFlag},
                #{errorMsg},
                #{sendTime},
                #{receiptNumber}
            FROM dual
            WHERE NOT exists(SELECT 1
                             FROM inter_ate_order_jx_price_difference_return_inf
                             WHERE main_order_number = #{mainOrderNumber}
                                   AND sku = #{sku})

    </insert>

    <insert id="saveOrderJxPriceDifferenceRefundInf"
            parameterType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.ReturnOrderJxPriceDifferenceRefundInf">
        INSERT INTO inter_ate_return_order_jx_price_difference_refund_inf (main_return_number, main_order_number, sob_id, store_org_code, diy_site_code,
                                                                           refund_date, refund_number, sku, amount, description, attribute1, attribute2,
                                                                           attribute3, attribute4, attribute5, create_time, send_flag, error_msg, send_time)
            SELECT
                #{mainReturnNumber},
                #{mainOrderNumber},
                #{sobId},
                #{storeOrgCode},
                #{diySiteCode},
                #{refundDate},
                #{refundNumber},
                #{sku},
                #{amount},
                #{description},
                #{attribute1},
                #{attribute2},
                #{attribute3},
                #{attribute4},
                #{attribute5},
                #{createTime},
                #{sendFlag},
                #{errorMsg},
                #{sendTime}
            FROM dual
            WHERE NOT exists(SELECT 1
                             FROM inter_ate_return_order_jx_price_difference_refund_inf
                             WHERE main_return_number = #{mainReturnNumber}
                                   AND sku = #{sku})

    </insert>

    <select id="getOrderJxPriceDifferenceReturnInf" parameterType="java.lang.String"
            resultType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.OrderJxPriceDifferenceReturnInf">
        SELECT
            receipt_id,
            main_order_number,
            sob_id,
            store_org_code,
            diy_site_code,
            receipt_date,
            sku,
            amount,
            description,
            attribute1,
            attribute2,
            attribute3,
            attribute4,
            attribute5,
            create_time,
            send_flag,
            error_msg,
            send_time,
            receipt_number
        FROM inter_ate_order_jx_price_difference_return_inf
        WHERE main_order_number = #{orderNumber}
    </select>

    <select id="getOrderJxPriceDifferenceRefundInf" parameterType="java.lang.String"
            resultType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.ReturnOrderJxPriceDifferenceRefundInf">
        SELECT *
        FROM inter_ate_return_order_jx_price_difference_refund_inf
        WHERE main_return_number = #{returnNumber}
    </select>

    <update id="updateOrderJxPriceDifferenceReturnInf">
        UPDATE inter_ate_order_jx_price_difference_return_inf
        <set>
            <if test="null != flag">
                send_flag = #{flag},
            </if>
            <if test="null != msg">
                error_msg = #{msg},
            </if>
            <if test="null != sendTime">
                send_time = #{sendTime}
            </if>
        </set>
        WHERE receipt_id in
        <foreach collection="returnInfIds" open="(" close=")" separator="," item="id" index="index">
            #{id}
        </foreach>
    </update>

    <select id="isReturnOrderExist" parameterType="java.lang.String" resultType="java.lang.Boolean">
        SELECT exists(SELECT 1
                      FROM inter_ate_return_order_base_inf
                      WHERE main_return_number = #{returnNumber})
    </select>

    <update id="updateOrderJxPriceDifferenceRefundInf">
        UPDATE inter_ate_return_order_jx_price_difference_refund_inf
        <set>
            <if test="null != flag">
                send_flag = #{flag},
            </if>
            <if test="null != msg">
                error_msg = #{msg},
            </if>
            <if test="null != sendTime">
                send_time = #{sendTime}
            </if>
        </set>
        WHERE receipt_id in
        <foreach collection="refundInfIds" open="(" close=")" separator="," item="id" index="index">
            #{id}
        </foreach>
    </update>

    <select id="getOrderBaseInfByMainOrderNumberAndCompanFlag"
            resultType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.OrderBaseInf">
        SELECT
            order_header_id,
            create_time,
            send_flag,
            error_msg,
            send_time,
            main_order_number,
            order_number,
            sob_id,
            order_date,
            order_subject_type,
            product_type,
            order_type_id,
            user_id,
            sales_consult_id,
            decorate_manager_id,
            coupon_flag,
            invoice_flag,
            credit_flag,
            store_org_id,
            diy_site_code,
            delivery_type_title,
            order_amt,
            rec_amt,
            lebi_discount,
            store_subvention_discount,
            promotion_discount,
            member_discount,
            cash_coupon_discount,
            product_coupon_discount,
            attribute1,
            attribute2,
            attribute3,
            attribute4,
            attribute5,
            attribute6,
            attribute7
        FROM inter_ate_order_base_inf
        WHERE main_order_number = #{orderNumber} AND product_type = #{flag}
    </select>

    <insert id="saveReturnOrderBaseInf"
            parameterType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.ReturnOrderBaseInf"
            keyColumn="rt_header_id" keyProperty="rtHeaderId" useGeneratedKeys="true">
        INSERT INTO inter_ate_return_order_base_inf (rt_header_id, return_number, main_return_number, order_number,
                                                     main_order_number, sob_id, return_date, rt_full_flag, refund_amount, return_type,
                                                     userid, seller_id, diy_site_code, store_org_code, order_type_id, deliver_type_title,
                                                     attribute1, attribute2, attribute3, attribute4, attribute5, create_time, send_flag,
                                                     error_msg, send_time)
            SELECT
                #{rtHeaderId},
                #{returnNumber},
                #{mainReturnNumber},
                #{orderNumber},
                #{mainOrderNumber},
                #{sobId},
                #{returnDate},
                #{rtFullFlag},
                #{refundAmount},
                #{returnType},
                #{userId},
                #{sellerId},
                #{diySiteCode},
                #{storeOrgCode},
                #{orderTypeId},
                #{deliverTypeTitle},
                #{attribute1},
                #{attribute2},
                #{attribute3},
                #{attribute4},
                #{attribute5},
                #{createTime},
                #{sendFlag},
                #{errorMsg},
                #{sendTime}
            FROM dual
            WHERE NOT exists(
                    SELECT 1
                    FROM inter_ate_return_order_base_inf
                    WHERE return_number = #{returnNumber}
            )

    </insert>

    <insert id="saveReturnOrderGoodsInf"
            parameterType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.ReturnOrderGoodsInf">
        INSERT INTO inter_ate_return_order_goods_inf (rt_header_id, return_number, main_return_number, order_number, main_order_number, order_line_id,
                                                      goods_title, sku, quantity, ls_price, hy_price, jx_price, settlement_price,
                                                      return_price, attribute1, attribute2, attribute3, attribute4, attribute5, create_time,
                                                      send_flag, error_msg, send_time)
            SELECT
                #{rtHeaderId},
                #{returnNumber},
                #{mainReturnNumber},
                #{orderNumber},
                #{mainOrderNumber},
                #{orderLineId},
                #{goodsTitle},
                #{sku},
                #{quantity},
                #{lsPrice},
                #{hyPrice},
                #{jxPrice},
                #{settlementPrice},
                #{returnPrice},
                #{attribute1},
                #{attribute2},
                #{attribute3},
                #{attribute4},
                #{attribute5},
                #{createTime},
                #{sendFlag},
                #{errorMsg},
                #{sendTime}
            FROM dual
            WHERE NOT exists(
                    SELECT 1
                    FROM inter_ate_return_order_goods_inf
                    WHERE order_line_id = #{orderLineId}
            )
    </insert>

    <insert id="saveReturnOrderCouponInf"
            parameterType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.ReturnOrderCouponInf">
        INSERT INTO inter_ate_return_order_coupon_inf (main_return_number, main_order_number, coupon_type_id, sku, buy_price, quantity,
                                                       attribute1, attribute2, attribute3, attribute4, attribute5, error_msg, send_flag, send_time,
                                                       create_time)
        VALUES (
            #{mainReturnNumber},
            #{mainOrderNumber},
            #{couponTypeId},
            #{sku},
            #{buyPrice},
            #{quantity},
            #{attribute1},
            #{attribute2},
            #{attribute3},
            #{attribute4},
            #{attribute5},
            #{errorMsg},
            #{sendFlag},
            #{sendTime},
            #{createTime})
    </insert>

    <insert id="saveReturnOrderRefundInf"
            parameterType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.ReturnOrderRefundInf">
        INSERT INTO inter_ate_return_order_refund_inf (main_order_number, main_return_number, refund_number, user_id, diy_site_code, store_org_code,
                                                       refund_type, refund_date, amount, description, sob_id, attribute1, attribute2, attribute3,
                                                       attribute4, attribute5, create_time, send_flag, error_msg, send_time)
            SELECT
                #{mainOrderNumber},
                #{mainReturnNumber},
                #{refundNumber},
                #{userId},
                #{diySiteCode},
                #{storeOrgCode},
                #{refundType},
                #{refundDate},
                #{amount},
                #{description},
                #{sobId},
                #{attribute1},
                #{attribute2},
                #{attribute3},
                #{attribute4},
                #{attribute5},
                #{createTime},
                #{sendFlag},
                #{errorMsg},
                #{sendTime}
            FROM dual
            WHERE NOT exists(
                    SELECT 1
                    FROM inter_ate_return_order_refund_inf
                    WHERE refund_number = #{refundNumber}
            )
    </insert>

    <select id="getReturnOrderBaseInfByReturnNumber" parameterType="java.lang.String"
            resultType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.ReturnOrderBaseInf">
        SELECT
            rt_header_id,
            return_number,
            main_return_number,
            order_number,
            main_order_number,
            sob_id,
            return_date,
            rt_full_flag,
            refund_amount,
            return_type,
            userid,
            seller_id,
            diy_site_code,
            store_org_code,
            order_type_id,
            deliver_type_title,
            attribute1,
            attribute2,
            attribute3,
            attribute4,
            attribute5,
            create_time,
            send_flag,
            error_msg,
            send_time
        FROM inter_ate_return_order_base_inf
        WHERE main_return_number = #{returnNumber}
    </select>

    <select id="getReturnOrderGoodsInfByReturnNumber" parameterType="java.lang.String"
            resultType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.ReturnOrderGoodsInf">
        SELECT
            rt_line_id,
            rt_header_id,
            return_number,
            main_return_number,
            order_number,
            main_order_number,
            order_line_id,
            goods_title,
            sku,
            quantity,
            ls_price,
            hy_price,
            jx_price,
            settlement_price,
            return_price,
            attribute1,
            attribute2,
            attribute3,
            attribute4,
            attribute5,
            create_time,
            send_flag,
            error_msg,
            send_time
        FROM inter_ate_return_order_goods_inf
        WHERE return_number = #{returnNumber}
    </select>

    <update id="updateReturnOrderBaseInf">
        UPDATE inter_ate_return_order_base_inf
        <set>
            <if test="null != flag">
                send_flag = #{flag},
            </if>
            <if test="null != errorMsg">
                error_msg = #{errorMsg},
            </if>
            <if test="null != sendTime">
                send_time = #{sendTime}
            </if>
        </set>
        WHERE return_number = #{returnNumber}
    </update>

    <update id="updateReturnOrderGoodsInf">
        UPDATE inter_ate_return_order_goods_inf
        <set>
            <if test="null != flag">
                send_flag = #{flag},
            </if>
            <if test="null != errorMsg">
                error_msg = #{errorMsg},
            </if>
            <if test="null != sendTime">
                send_time = #{sendTime}
            </if>
        </set>
        WHERE return_number = #{returnNumber}
    </update>


    <update id="updateOrderReceiveFlagAndSendTimeAndErrorMsg">
        UPDATE inter_ate_order_receive_inf
        <set>
            <if test="null != flag">
                send_flag = #{flag},
            </if>
            <if test="null != msg">
                error_msg = #{msg},
            </if>
            <if test="null != sendTime">
                send_time = #{sendTime}
            </if>
        </set>
        WHERE id = #{receiveInfsId}
    </update>


    <update id="updateReturnOrderFlagAndSendTimeAndErrorMsg">
        UPDATE inter_ate_return_order_base_inf
        <set>
            <if test="null != flag">
                send_flag = #{flag},
            </if>
            <if test="null != msg">
                error_msg = #{msg},
            </if>
            <if test="null != sendTime">
                send_time = #{sendTime}
            </if>
        </set>
        WHERE rt_header_id = #{rtHeaderId}
    </update>

    <select id="getReturnOrderCouponInf" parameterType="java.lang.String"
            resultType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.ReturnOrderCouponInf">
        SELECT
            line_id,
            main_return_number,
            main_order_number,
            coupon_type_id,
            sku,
            buy_price,
            quantity,
            attribute1,
            attribute2,
            attribute3,
            attribute4,
            attribute5,
            error_msg,
            send_flag,
            send_time,
            create_time
        FROM inter_ate_return_order_coupon_inf
        WHERE main_return_number = #{returnNumber}
    </select>

    <update id="updateReturnOrderCouponInf">
        UPDATE inter_ate_return_order_coupon_inf
        <set>
            <if test="null != flag">
                send_flag = #{flag},
            </if>
            <if test="null != sendTime">
                send_time = #{sendTime},
            </if>
            <if test="null != msg">
                error_msg = #{msg}
            </if>
        </set>
        WHERE line_id in
        <foreach collection="returnCouponInfLineId" item="id" index="index" open="(" close=")" separator=",">
            #{id}
        </foreach>
    </update>


    <select id="getReturnOrderRefundInf" parameterType="java.lang.String"
            resultType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.ReturnOrderRefundInf">
        SELECT
            refund_id,
            main_order_number,
            main_return_number,
            refund_number,
            user_id,
            diy_site_code,
            store_org_code,
            refund_type,
            refund_date,
            amount,
            description,
            sob_id,
            attribute1,
            attribute2,
            attribute3,
            attribute4,
            attribute5,
            create_time,
            send_flag,
            error_msg,
            send_time
        FROM inter_ate_return_order_refund_inf
        WHERE main_return_number = #{returnNumber}
    </select>

    <update id="updateReturnOrderRefundInf">
        UPDATE inter_ate_return_order_refund_inf
        <set>
            <if test="null != flag">
                send_flag = #{flag},
            </if>
            <if test="null != sendTime">
                send_time = #{sendTime},
            </if>
            <if test="null != msg">
                error_msg = #{msg}
            </if>
        </set>
        WHERE refund_id in
        <foreach collection="refundInfIds" open="(" close=")" separator="," item="id" index="index">
            #{id}
        </foreach>
    </update>

    <select id="getReturnOrderJxPriceDifferenceRefundInf" parameterType="java.lang.String"
            resultType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.ReturnOrderJxPriceDifferenceRefundInf">
        SELECT
            refund_id,
            main_return_number,
            main_order_number,
            sob_id,
            store_org_code,
            diy_site_code,
            refund_date,
            refund_number,
            sku,
            amount,
            description,
            attribute1,
            attribute2,
            attribute3,
            attribute4,
            attribute5,
            create_time,
            send_flag,
            error_msg,
            send_time
        FROM inter_ate_return_order_jx_price_difference_refund_inf
        WHERE main_return_number = #{returnNumber}
    </select>

    <update id="updateReturnOrderJxPriceDifferenceRefundInf">
        UPDATE inter_ate_return_order_jx_price_difference_refund_inf
        <set>
            <if test="null != flag">
                send_flag = #{flag},
            </if>
            <if test="null != sendTime">
                send_time = #{sendTime},
            </if>
            <if test="null != msg">
                error_msg = #{msg}
            </if>
        </set>
        WHERE refund_id in
        <foreach collection="refundInfIds" open="(" close=")" separator="," item="id" index="index">
            #{id}
        </foreach>
    </update>

    <insert id="saveOrderFreightInf"
            parameterType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.OrderFreightInf">
        INSERT INTO inter_ate_order_freight_inf (main_order_number, type, order_amt, goods_amt, amount, attribute1,
                                                 attribute2, attribute3, attribute4, attribute5)
        VALUES (#{mainOrderNumber}, #{type}, #{orderAmt}, #{goodsAmt}, #{amount}, #{attribute1}, #{attribute2},
                #{attribute3},
                #{attribute4}, #{attribute5})
    </insert>
    <select id="getOrderFreightInfByMainOrderNumber" parameterType="java.lang.String"
            resultType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.OrderFreightInf">
        SELECT
            id,
            main_order_number,
            type,
            order_amt,
            goods_amt,
            amount,
            attribute1,
            attribute2,
            attribute3,
            attribute4,
            attribute5
        FROM inter_ate_order_freight_inf
        WHERE main_order_number = #{orderNumber}
    </select>

    <update id="updateOrderFreightInfFlagAndSendTimeAndErrorMsg">
        UPDATE inter_ate_order_freight_inf
        <set>
            <if test="null != sendFlag">
                send_flag = #{sendFlag},
            </if>
            <if test="null != sendTime">
                send_time = #{sendTime},
            </if>
            <if test="null != msg">
                error_msg = #{msg}
            </if>
        </set>
        WHERE id =#{id}
    </update>
</mapper>
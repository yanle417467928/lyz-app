<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.leyizhuang.app.foundation.dao.AppSeparateOrderDAO">

    <select id="isOrderExist" parameterType="java.lang.String" resultType="java.lang.Boolean">
        SELECT exists(SELECT 1
                      FROM inter_ate_order_base_inf
                      WHERE main_order_number = #{orderNumber})
    </select>

    <insert id="saveOrderBaseInf"
            parameterType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.OrderBaseInf"
            useGeneratedKeys="true" keyProperty="headerId">
        INSERT INTO inter_ate_order_base_inf (create_time, order_subject_type, send_flag, error_msg, send_time, main_order_number, order_number,
                                              sob_id, order_date, product_type, order_type_id, user_id, sales_consult_id,
                                              coupon_flag, invoice_flag, credit_flag, store_org_id, store_code, delivery_type_title,
                                              order_amt, rec_amt, lebi_discount, store_subvention_discount, promotion_discount,
                                              member_discount, cash_coupon_discount, product_coupon_discount)
        VALUES (
            #{createTime}, #{orderSubjectType}, #{sendFlag}, #{errorMsg}, #{sendTime}, #{mainOrderNumber},
                           #{orderNumber}, #{sobId},
                           #{orderDate}, #{productType},
                           #{orderTypeId}, #{userId}, #{salesConsultId}, #{couponFlag}, #{invoiceFlag}, #{creditFlag},
                                           #{storeOrgId}, #{storeCode}, #{deliveryTypeTitle},
                                           #{orderAmt}, #{recAmt}, #{lebiDiscount},
            #{storeSubventionDiscount}, #{promotionDiscount}, #{memberDiscount}, #{cashCouponDiscount},
            #{productCouponDiscount}
        )
    </insert>

    <insert id="saveOrderGoodsInf"
            parameterType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.OrderGoodsInf">
        INSERT INTO inter_ate_order_goods_inf (header_id, create_time, send_flag, error_msg, send_time, order_line_id, main_order_number, order_number,
                                               sku, goods_title, quantity, retail_price,
                                               hy_price, jx_price, settlement_price, return_price, lebi_discount, subvention_discount,
                                               cash_coupon_discount, promotion_discount, discount_total_price, gift_flag, promotion_id, product_type)
        VALUES
            (#{headerId}, #{createTime}, #{sendFlag}, #{errorMsg}, #{sendTime}, #{orderLineId}, #{mainOrderNumber},
                          #{orderNumber},
                          #{sku}, #{goodsTitle}, #{quantity}, #{retailPrice}, #{hyPrice},
                                                              #{jxPrice}, #{settlementPrice},
                                                              #{returnPrice}, #{lebiDiscount},
                                                              #{subventionDiscount},
                                                              #{cashCouponDiscount},
                                                              #{promotionDiscount},
                                                              #{discountTotalPrice}, #{giftFlag},
             #{promotionId}, #{productType})
    </insert>

    <insert id="saveOrderCouponInf"
            parameterType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.OrderCouponInf">
        INSERT INTO inter_ate_order_coupon_inf (main_order_number, create_time, send_flag, error_msg, send_time, history_flag,
                                                get_type, product_type, purchase_price, cost_price, coupon_id, sku, quantity)
        VALUES (#{mainOrderNumber}, #{createTime}, #{sendFlag}, #{errorMsg}, #{sendTime}, #{historyFlag}, #{getType},
                                    #{productType}, #{purchasePrice},
                                    #{costPrice}, #{couponId}, #{sku}, #{quantity})
    </insert>

    <insert id="saveOrderReceiptInf"
            parameterType="cn.com.leyizhuang.app.foundation.pojo.remote.webservice.ebs.OrderReceiptInf">
        INSERT INTO inter_ate_order_receipt_inf (create_time, send_flag, error_msg, send_time, main_order_number, receipt_number,
                                                 receipt_type, store_org_id, store_code, receipt_date, amount, description)
            SELECT
                #{createTime},
                #{sendFlag},
                #{errorMsg},
                #{sendTime},
                #{mainOrderNumber},
                #{receiptNumber},
                #{receiptType},
                #{storeOrgId},
                #{storeCode},
                #{receiptDate},
                #{amount},
                #{description}
            FROM dual
            WHERE NOT exists(SELECT 1
                             FROM inter_ate_order_receipt_inf
                             WHERE receipt_number = #{receiptNumber})
    </insert>

</mapper>
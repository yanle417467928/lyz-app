<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.leyizhuang.app.foundation.dao.ArrearsAuditDAO">

    <select id="findByUserIdAndStatus" resultType="cn.com.leyizhuang.app.foundation.pojo.response.ArrearsAuditResponse">
        SELECT id, ord_no orderNumber, customer_name customerName, customer_phone customerPhone,
        seller_name sellerName, seller_phone sellerPhone, distribution_address distributionAddress,
        distribution_time distributionTime, agency_money agencyMoney, real_money realMoney,
        payment_method paymentMethod, status, order_money orderMoney
        FROM ord_arrears_audit
        WHERE user_id = #{userId}
        AND status IN
        <foreach collection="list" item="status" open="(" close=")" separator=",">
            #{status}
        </foreach>
        ORDER BY create_time desc
    </select>

    <select id="findByUserIdAndOrderNoAndStatus" resultType="cn.com.leyizhuang.app.foundation.pojo.response.ArrearsAuditResponse">
        SELECT id, ord_no orderNumber, customer_name customerName, customer_phone customerPhone,
        seller_name sellerName, seller_phone sellerPhone, distribution_address distributionAddress,
        distribution_time distributionTime, agency_money agencyMoney, real_money realMoney,
        payment_method paymentMethod, status, order_money orderMoney
        FROM ord_arrears_audit
        WHERE user_id = #{userId}
        AND ord_no = #{orderNo}
        AND status IN
        <foreach collection="list" item="status" open="(" close=")" separator=",">
            #{status}
        </foreach>
        ORDER BY create_time desc
    </select>

    <insert id="save" parameterType="cn.com.leyizhuang.app.foundation.pojo.order.OrderArrearsAuditDO">
        INSERT INTO ord_arrears_audit
        (user_id,customer_name,customer_phone,seller_name,seller_phone,ord_no,agency_money,order_money,
        real_money,cash_money,pos_money,alipay_money,wechat_money,payment_method,distribution_address,
        distribution_time,remarks,status,create_time,seller_id)
        VALUES
        (#{userId},#{customerName},#{customerPhone},#{sellerName},#{sellerphone},#{orderNumber},#{agencyMoney},#{orderMoney},
        #{realMoney},#{cashMoney},#{posMoney},#{alipayMoney},#{wechatMoney},#{paymentMethod},#{distributionAddress},
        #{distributionTime},#{remarks},#{status},#{createTime},#{sellerId})
    </insert>

    <select id="findBySellerIdAndStatus" resultType="cn.com.leyizhuang.app.foundation.pojo.response.SellerArrearsAuditResponse">
        SELECT oa.id, oa.ord_no orderNumber, oa.customer_name customerName, oa.customer_phone customerPhone,
        (oa.order_money - oa.real_money) arrearsMoney, oa.create_time createTime,
        oa.payment_method paymentMethod, oa.status, oa.order_money orderMoney,
        e.name deliveryName, e.mobile deliveryPhone
        FROM ord_arrears_audit oa
        LEFT JOIN emp_employee e ON e.emp_id = oa.user_id
        WHERE oa.seller_id = #{sellerId}
        AND oa.status IN
        <foreach collection="list" item="status" open="(" close=")" separator=",">
            #{status}
        </foreach>
        ORDER BY oa.create_time desc
    </select>

    <select id="findArrearsListByUserId" resultType="cn.com.leyizhuang.app.foundation.pojo.response.ArrearageListResponse">
        SELECT
            obi.customer_name customerName,
            obi.ord_no orderNumber,
            obd.arrearage arrearageMoney
        FROM
            ord_base_info AS obi
        INNER JOIN ord_billing_details AS obd ON obi.ord_no = obd.ord_no
        WHERE obi.sales_consult_id = #{userID}
        AND obd.arrearage != 0
    </select>

</mapper>
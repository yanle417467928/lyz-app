<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.leyizhuang.app.foundation.dao.MaFitBillDAO">
    <resultMap id="billInfo" type="cn.com.leyizhuang.app.foundation.pojo.bill.BillInfoDO">
        <id column="ID" property="id"/>
        <result column="bill_no" property="billingNo"/>
        <result column="bill_name" property="billName"/>
        <result column="store_id" property="storeId"/>
        <result column="bill_start_date" property="billStartDate"/>
        <result column="bill_end_date" property="billEndDate"/>
        <result column="repayment_deadline_date" property="repaymentDeadlineDate"/>
        <result column="bill_total_amount" property="billTotalAmount"/>
        <result column="current_bill_amount" property="currentBillAmount"/>
        <result column="current_adjustment_amount" property="currentAdjustmentAmount"/>
        <result column="current_paid_amount" property="currentPaidAmount"/>
        <result column="current_unpaid_amount" property="currentUnpaidAmount"/>
        <result column="prior_paid_bill_amount" property="priorPaidBillAmount"/>
        <result column="prior_paid_interest_amount" property="priorPaidInterestAmount"/>
        <result column="status" property="identityCard"
                javaType="cn.com.leyizhuang.app.core.constant.BillStatusEnum"
                typeHandler="org.apache.ibatis.type.EnumTypeHandler"/>
        <result column="bill_time" property="billTime"/>
        <result column="create_time" property="createTime"/>
        <result column="create_user_id" property="createUserId"/>
        <result column="create_user_name" property="createUserName"/>
    </resultMap>

    <select id="getFitNotOutBill"
                         resultType="cn.com.leyizhuang.app.foundation.vo.management.decorativeCompany.MaFitBillVO">
    select
    b.bill_name,b.bill_no,a.store_name,b.bill_start_date,b.bill_end_date,b.repayment_deadline_date,b.bill_total_amount,b.current_paid_amount,b.current_unpaid_amount
    from bill_info b
    LEFT JOIN st_store a on b.store_id = a.store_id
    WHERE
    b.status=0
    <if test="null!=keywords and ''!=keywords">
        AND
        (
        b.bill_no LIKE CONCAT('%',#{keywords},'%')
        OR
        bill_name LIKE CONCAT('%',#{keywords},'%')
        )
    </if>
    AND
    b.store_id IN
    <foreach collection="list" item="item" open="(" close=")" separator=",">
        #{item}
    </foreach>
    order by b.create_time DESC
</select>



    <select id="getHistoryFitBill"
            resultType="cn.com.leyizhuang.app.foundation.vo.management.decorativeCompany.MaFitBillVO">
        select
        b.bill_name,b.bill_no,a.store_name,b.bill_start_date,b.bill_end_date,b.repayment_deadline_date,b.bill_total_amount,b.current_paid_amount,b.current_unpaid_amount
        from bill_info b
        LEFT JOIN st_store a on b.store_id = a.store_id
        WHERE
        b.status= 2
        <if test="null!=keywords and ''!=keywords">
            AND
            (
            b.bill_no LIKE CONCAT('%',#{keywords},'%')
            OR
            bill_name LIKE CONCAT('%',#{keywords},'%')
            )
        </if>
        AND
        b.store_id IN
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
        order by b.create_time DESC
    </select>


    <select id="getFitBillByBillNo" resultMap="billInfo">
        select
        *
        from bill_info b
        LEFT JOIN st_store a on b.store_id = a.store_id
        WHERE
        b.bill_no = #{billNo}
    </select>

    <select id="getUnPaidBillByBillNo"
            resultType="cn.com.leyizhuang.app.foundation.pojo.bill.BillInfoDO">
        select
        *
        from bill_repayment_info  b LEFT JOIN  bill_repayment_goods_details  a  on b.id =a.repayment_id
        where a.is_paid = 0
    </select>

    <select id="getPaidBillByBillNo"
            resultType="cn.com.leyizhuang.app.foundation.pojo.bill.BillInfoDO">
        select
        *
        from bill_repayment_info  b LEFT JOIN  bill_repayment_goods_details  a  on b.id =a.repayment_id
        where a.is_paid = 1
    </select>



</mapper>